#!/usr/bin/env bash
## Runner executable
## --------------------------------------------------------
##  Copyright (c) 2019 Aleksej Komarov
##  SPDX-License-Identifier: LGPL-3.0-or-later
## --------------------------------------------------------

## Expand aliases
shopt -s expand_aliases

## Returns an absolute path to file
alias runner-realpath="readlink -f"

## Fallbacks for GNU readlink
## Detecting GNU coreutils http://stackoverflow.com/a/8748344/319952
if ! readlink --version >/dev/null 2>&1; then
  if hash greadlink 2>/dev/null; then
    alias runner-realpath="greadlink -f"
  else
    alias runner-realpath="perl -MCwd -le 'print Cwd::abs_path(shift)'"
  fi
fi

if [[ "${FUNCNAME[0]}" == source ]]; then
  echo "Can't source the 'runner' executable. Instead, source 'lib/runner.sh' directly."
  exit 1
fi

## Resolve the absolute path to the source folder
runner_lib_dir="$(dirname "$(runner-realpath "${0}")")/../lib"

## Resolve resolved path to remove the '../' part
runner_lib_dir="$(runner-realpath "${runner_lib_dir}")"

## Include core files
# shellcheck source=lib/runner.sh
source "${runner_lib_dir}/runner.sh"

## Include CLI specific files
# shellcheck source=lib/runner-cli.sh
source "${runner_lib_dir}/runner-cli.sh"
